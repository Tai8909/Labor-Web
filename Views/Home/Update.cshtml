@{
    ViewData["Title"] = "更新保單";
}

<script language="javascript">
    function convertToISO(timebit) {
        // remove GMT offset
        timebit.setHours(0, -timebit.getTimezoneOffset(), 0, 0);
        // format convert and take first 10 characters of result
        var isodate = timebit.toISOString().slice(0, 10);
        return isodate;
    }
    function noSundays(e) {
        // Days in JS range from 0-6 where 0 is Sunday and 6 is Saturday
        var day = new Date(e.target.value).getUTCDay();
        if (day == 0 || day == 6) {
            e.target.setCustomValidity('不可選擇週日！');
        } else {
            e.target.setCustomValidity('');
        }
    }
    function StudentInfo(data){
        console.log(data);
        $.ajax({
            url:"/api/school/Studentinfo",
            type:"POST",
            contentType: "application/json; charset=utf-8",
            data: data,
            success: function (result, status) {
                if(! jQuery.isEmptyObject(result)){
                    console.log(result);
                    $("#HiredName").val(result[0].cname);
                    $("#ID").val(result[0].id);
                    var date_time = result[0].birthday;
                    var readable_date = date_time.substr(0,10);
                    $("#Birthday").val(readable_date);
                    $("#pclass").val(result[0].pclass);
                    $("#sclass").val(result[0].sclass);
                    $("#School").val(result[0].department);
                    $("#Email").val(result[0].email);
                    $("#Phone").val(result[0].phone);
                }
                else{
                    $("#HiredName").val('');
                    $("#ID").val('');
                    $("#Birthday").val('');
                    $("#pclass").val('');
                    $("#sclass").val('');
                    $("#School").val('');
                    $("#Email").val('');
                    $("#Phone").val('');
                }
            },
            error:function (error){
                console.log(error);
            }
        });
        return data;
    }
</script>

<style>
    input:invalid {
        background-color: #E00;
    }
</style>

<form method="post" id="updatelabform" class="form-group">
    <div class="form-group" id="NoDiv">
        <input type="hidden" class="form-control" id="TempNo" name="TempNo" value="">
    </div>
    <!-- Input and Submit elements -->
    <div class="form-group">
        <label for="ApplyItem">申請項目</label>
        <select id="ApplyItem" name="ApplyItem" class="form-control">
            <option value="加保">加保</option>
            <option value="退保">退保</option>
        </select>
    </div>
    <div class="form-group">
        <label for="StudentID">被保險人學號</label>
        <input type="text" class="form-control" id="StudentID" name="StudentID" aria-describedby="StudentIDSmall" placeholder="輸入被保險人學號" value="">
        <small id="StudentIDSmall" class="form-text text-muted"></small>
    </div>
    <div class="row">
        <div class="col">
            <div class="form-group">
                <label for="HiredName">被保險人姓名</label>
                <input type="text" class="form-control" id="HiredName" name="HiredName" aria-describedby="HiredNameSmall" placeholder="輸入被保險人姓名" value="">
                <small id="HiredNameSmall" class="form-text text-muted"></small>
            </div>
        </div>
        <div class="col">
            <div class="form-group">
                <label for="ID">被保險人身分證字號</label>
                <input type="text" class="form-control" id="ID" name="ID" aria-describedby="IDSmall" placeholder="輸入被保險人身分證字號" value="">
                <small id="IDSmall" class="form-text text-muted"></small>
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col">
            <div class="form-group">
                <label for="School">被保險人學校/系所</label>
                <input type="text" class="form-control" id="School" name="School" aria-describedby="SchoolSmall" placeholder="輸入被保險人學校/系所" value="">
                <small id="SchoolSmall" class="form-text text-muted"></small>
            </div>
        </div>
        <div class="col">
            <div class="form-group">
                <label for="Birthday">被保險人出生日期</label>
                <input type="date" class="form-control" id="Birthday" name="Birthday" aria-describedby="BirthdaySmall" placeholder="輸入被保險人出生日期" value="" max="" min="">
                <small id="BirthdaySmall" class="form-text text-muted"></small>
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col">
            <div class="form-group">
                <label for="Phone">被保險人手機</label>
                <input type="number" class="form-control" id="Phone" name="Phone" aria-describedby="PhoneSmall" placeholder="輸入被保險人手機" value="">
                <small id="PhoneSmall" class="form-text text-muted"></small>
            </div>
        </div>
        <div class="col">
            <div class="form-group">
                <label for="Email">被保險人E-mail</label>
                <input type="email" class="form-control" id="Email" name="Email" aria-describedby="EmailSmall" placeholder="輸入被保險人E-mail" value="">
                <small id="EmailSmall" class="form-text text-muted"></small>
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col">
            <div class="form-group">
                <label for="IsForeign">被保險人國籍</label>
                <select id="IsForeign" name="IsForeign" class="form-control">
                    <option value="本國人">本國人</option>
                    <option value="外國人">外國人</option>
                </select>
            </div>
        </div>
        <div class="col">
            <div class="form-group">
                <p>被保險人是否有身心障礙</p>
                <label for="DisabilityRadio">無</label>
                <input type="radio" id="DisabilityRadio" name="Disability" value="無"><br />
                <label for="AbilityRadio">有</label>
                <input type="radio" id="AbilityRadio" name="Disability" value="有">
            </div>
        </div>
        <div class="col">
            <div class="form-group">
                <label for="WorkType">被保險人工作類別</label>
                <select id="WorkType" name="WorkType" class="form-control">
                    <option value="兼任助理">兼任助理</option>
                    <option value="臨時工">臨時工</option>
                </select>
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col">
            <div class="form-group">
                <label for="HiredDep">用人單位</label>
                <input type="text" class="form-control" id="HiredDep" name="HiredDep" aria-describedby="HiredDepSmall" placeholder="輸入用人單位" value="">
                <small id="HiredDepSmall" class="form-text text-muted"></small>
            </div>
        </div>
        <div class="col">
            <div class="form-group">
                <label for="Boss">僱主</label>
                <input type="text" class="form-control" id="Boss" name="Boss" aria-describedby="BossSmall" placeholder="輸入僱主" value="">
                <small id="BossSmall" class="form-text text-muted"></small>
            </div>
        </div>
    </div>
    <div class="form-group">
        <label for="Bugeno">計畫編號</label>
        <input type="text" class="form-control" id="Bugeno" name="Bugeno" aria-describedby="BugenoSmall" placeholder="輸入計畫編號" value="">
        <small id="BugenoSmall" class="form-text text-muted"></small>
    </div>
    <div class="row">
        <div class="col">
            <div class="form-group">
                <label for="StartTime">起始時間</label>
                <input type="date" class="form-control" id="StartTime" name="StartTime" aria-describedby="StartTimeSmall" placeholder="輸入起始/退保時間" value="" max="" min="" onchange="getstartyear()">
                <small id="StartTimeSmall" class="form-text text-muted">不可以選擇非工作日</small>
                <script language="javascript">
                    var bookdate = document.getElementById('StartTime');
                    bookdate.addEventListener('input', noSundays);
                </script>
            </div>
        </div>
        <div class="col">
            <div class="form-group">
                <label for="EndTime">結束時間</label>
                <input type="date" class="form-control" id="EndTime" name="EndTime" aria-describedby="EndTimeSmall" placeholder="輸入結束時間" value="" max="" min="">
                <small id="EndTimeSmall" class="form-text text-muted"></small>
                <script language="javascript">
                    // 將開始日期的年份處理(結束日期只能選該年)
                    function getstartyear() {
                        var start = new Date(document.getElementById('StartTime').value);
                        var year = start.getFullYear();
                        if (year % 400 == 0) {
                            isplus = 1;
                        }
                        else if (year % 100 == 0 && year % 400 != 0) {
                            isplus = 0;
                        }
                        else if (year % 4 == 0 && year % 100 != 0) {
                            isplus = 1;
                        }
                        else if (year % 4 != 0) {
                            isplus = 0;
                        }
                        // 擷取結束年
                        var bookdate = document.getElementById('EndTime');
                        var currentdate = new Date();
                        currentdate.setDate(currentdate.getDate() + 5);
                        bookdate.min = convertToISO(start);
                        var futuredate = new Date();
                        // go forward 7 days into the future
                        futuredate.setDate(365 * (year - futuredate.getFullYear() + 1) + isplus);
                        bookdate.max = convertToISO(futuredate);
                        bookdate.addEventListener('input', noSundays);
                    }
                </script>
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col">
            <div class="form-group" id="SalaryDiv">
                <label for="Class">薪資類別</label>
                <select id="Class" name="Class" class="form-control">
                    <option value="月薪">月薪</option>
                    <option value="日薪">日薪</option>
                    <option value="時薪">時薪</option>
                </select>
            </div>
        </div>
        <div class="col">
            <div class="form-group" id="PartSalaryDiv">
                <label for="PartSalary">每小時</label>
                <input type="number" class="form-control" id="PartSalary" name="PartSalary" aria-describedby="PartSalarySmall" placeholder="" value="">
                <small id="PartSalarySmall" class="form-text text-muted"></small>
            </div>
        </div>
        <div class="col">
            <div class="form-group" id="PartDayDiv">
                <label for="PartDay">天數</label>
                <input type="number" class="form-control" id="PartDay" name="PartDay" aria-describedby="PartDaySmall" placeholder="" value="">
                <small id="PartDaySmall" class="form-text text-muted"></small>
            </div>
        </div>
        <div class="col">
            <div class="form-group">
                <label for="Salary">月薪資總額</label>
                <input type="number" class="form-control" id="Salary" name="Salary" aria-describedby="SalarySmall" placeholder="輸入薪水" value="">
                <small id="SalarySmall" class="form-text text-muted"></small>
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col">
            <div class="form-group">
                <label for="SelfRetirePercent">自提勞工退休金</label>
                <select id="SelfRetirePercent" name="SelfRetirePercent" class="form-control">
                    <option value="0">0%</option>
                    <option value="1">1%</option>
                    <option value="2">2%</option>
                    <option value="3">3%</option>
                    <option value="4">4%</option>
                    <option value="5">5%</option>
                    <option value="6">6%</option>
                </select>
            </div>
        </div>
        <div class="col">
            <div class="form-group" id="InsuranceTypeDiv">
                <label for="InsuranceType">投保類型</label>
                <select id="InsuranceType" name="InsuranceType" class="form-control">
                    <option value="日保" id="InsuranceType_Day">日保</option>
                    <option value="月保" id="InsuranceType_Month" selected>月保</option>
                </select>
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col">
            <div class="form-group" id="ActualStartTimeDiv">
                <label for="ActualStartTime">實際加保時間</label>
                <input type="date" class="form-control" id="ActualStartTime" name="ActualStartTime" aria-describedby="ActualStartTime" placeholder="實際加保時間" value="" max="" min="">
                <small id="ActualStartTimeSmall" class="form-text text-muted"></small>
            </div>
        </div>
        <div class="col">
            <div class="form-group" id="ActualEndTimeDiv">
                <label for="ActualEndTime">實際結束時間</label>
                <input type="date" class="form-control" id="ActualEndTime" name="ActualEndTime" aria-describedby="ActualEndTime" placeholder="實際結束時間" value="" max="" min="">
            </div>
        </div>
    </div>
    <div class="form-group" id="RejectReasonDiv">
        <label for="RejectReason">審核失敗原因</label>
        <input type="text" class="form-control" id="RejectReason" name="RejectReason" placeholder="輸入審核失敗原因" value="">
    </div>
    <div class="row">
        <div class="col">
            <div class="form-group" id="LaborRankDiv">
                <label for="LaborRank">勞保級距</label>
                <input type="number" class="form-control" id="LaborRank" name="LaborRank" aria-describedby="LaborRankSmall" placeholder="輸入勞保級距" value="">
                <small id="LaborRankSmall" class="form-text text-muted"></small>
            </div>
        </div>
        <div class="col">
            <div class="form-group" id="LaborFundDiv">
                <label for="LaborFund">勞保工資墊償金</label>
                <input type="number" class="form-control" id="LaborFund" name="LaborFund" aria-describedby="LaborFundSmall" placeholder="輸入勞退自提" value="">
                <small id="LaborFundSmall" class="form-text text-muted"></small>
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col">
            <div class="form-group" id="DepLaborDiv">
                <label for="DepLabor">勞保公提</label>
                <input type="number" class="form-control" id="DepLabor" name="DepLabor" aria-describedby="DepLaborSmall" placeholder="輸入工資墊償金" value="">
                <small id="DepLaborSmall" class="form-text text-muted"></small>
            </div>
        </div>
        <div class="col">
            <div class="form-group" id="SelfLaborDiv">
                <label for="SelfLabor">勞保自提</label>
                <input type="number" class="form-control" id="SelfLabor" name="SelfLabor" aria-describedby="SelfLaborSmall" placeholder="輸入勞保自提" value="">
                <small id="SelfLaborSmall" class="form-text text-muted"></small>
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col">
            <div class="form-group" id="RetireRankDiv">
                <label for="RetireRank">勞工退休金</label>
                <input type="number" class="form-control" id="RetireRank" name="RetireRank" aria-describedby="RetireRankSmall" placeholder="輸入勞保公提" value="">
                <small id="RetireRankSmall" class="form-text text-muted"></small>
            </div>
        </div>
        <div class="col">
            <div class="form-group" id="DepRetireDiv">
                <label for="DepRetire">勞退公提</label>
                <input type="number" class="form-control" id="DepRetire" name="DepRetire" aria-describedby="DepRetireSmall" placeholder="輸入勞退公提" value="">
                <small id="DepRetireSmall" class="form-text text-muted"></small>
            </div>
        </div>
        <div class="col">
            <div class="form-group" id="SelfRetireDiv">
                <label for="SelfRetire">勞退自提</label>
                <input type="number" class="form-control" id="SelfRetire" name="SelfRetire" aria-describedby="SelfRetireSmall" placeholder="輸入勞退級距" value="">
                <small id="SelfRetireSmall" class="form-text text-muted"></small>
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col">
            <div class="form-group" id="ReceivePersonDiv">
                <label for="ReceivePerson">收件人</label>
                <input type="text" class="form-control" id="ReceivePerson" name="ReceivePerson" aria-describedby="ReceivePersonSmall" placeholder="輸入收件人" value="">
                <small id="ReceivePersonSmall" class="form-text text-muted"></small>
            </div>
        </div>
        <div class="col">
            <div class="form-group" id="FormStatusDiv">
                <p>審核狀態</p>
                <input type="radio" id="Ing" name="FormStatus" value="審核中" checked="checked">
                <label for="Ing">審核中</label><br />
                <input type="radio" id="Accept" name="FormStatus" value="審核通過">
                <label for="Accept">審核通過</label><br />
                <input type="radio" id="Reject" name="FormStatus" value="審核失敗">
                <label for="Reject">審核失敗</label>
            </div>
        </div>
    </div>
    <button type="submit" name="submit" id="submit" class="btn btn-primary">確定</button>
</form>
<div id="targetDiv">
</div>

@section scripts
{
    <script>
        $("document").ready(function () {
            var currentSearchString = window.location.search;
            currentSearchString = currentSearchString.replace("?No=","");
            console.log(currentSearchString);
            var data = "/api/school/"+currentSearchString;
            $.ajax({
                url: data,
                type: "GET",
                success: function (result, status) {
                    console.log(result);
                    $("#NoDiv").append('<p>No:' + result[0].no + '</p>');
                    $("#TempNo").val(result[0].no);
                    $("#ApplyItem").val(result[0].applyItem.replaceAll(" ",""));
                    $("#StudentID").val(result[0].studentID.replaceAll(" ",""));
                    $("#HiredName").val(result[0].hiredName.replaceAll(" ",""));
                    $("#ID").val(result[0].id.replaceAll(" ",""));
                    $("#School").val(result[0].school.replaceAll(" ",""));
                    $("#Birthday").val(result[0].birthday.split("T")[0]);
                    $("#Phone").val(result[0].phone.replaceAll(" ",""));
                    $("#Email").val(result[0].email.replaceAll(" ",""));
                    $("#IsForeign").val(result[0].isForeign.replaceAll(" ",""));
                    if(result[0].disability.replaceAll(" ","")=="無"){
                        $("#DisabilityRadio").prop("checked", true);
                    }if(result[0].disability.replaceAll(" ","")=="有"){
                        $("#AbilityRadio").prop("checked", true);
                    }
                    $("#WorkType").val(result[0].workType.replaceAll(" ",""));
                    $("#HiredDep").val(result[0].hiredDep.replaceAll(" ",""));
                    $("#Boss").val(result[0].boss.replaceAll(" ",""));
                    $("#Bugeno").val(result[0].bugeno.replaceAll(" ",""));
                    $("#StartTime").val(result[0].startTime.split("T")[0]);
                    $("#EndTime").attr('min',result[0].startTime.split("T")[0]);
                    $("#EndTime").val(result[0].endTime.split("T")[0]);
                    $("#Class").val(result[0].class.replaceAll(" ",""));
                    if(result[0].class.replaceAll(" ","")=="日薪"){
                        $("#PartSalaryDiv label").text("每日");
                        $("#PartSalary").val(result[0].partSalary);
                        if(result[0].partDay!=null){
                            $("#PartDay").val(result[0].partDay);
                        }
                    }if(result[0].class.replaceAll(" ","")=="時薪"){
                        $("#PartSalary").val(result[0].partSalary);
                        if(result[0].partDay!=null){
                            $("#PartDay").val(result[0].partDay);
                        }
                    }if(result[0].class.replaceAll(" ","")=="月薪"){
                        $("#InsuranceType_Day").attr('disabled','disabled');
                        $("#PartSalaryDiv").hide();
                        $("#PartDayDiv").hide();
                    }
                    $("#Salary").val(result[0].salary);
                    //if(result[0].receiveTime!=null){
                    //    $("#ReceiveTime").val(result[0].receiveTime);
                    //}
                    if(result[0].receivePerson!=null){
                        $("#ReceivePerson").val(result[0].receivePerson.replaceAll(" ",""));
                    }if(result[0].insuranceType!=null){
                        $("#InsuranceType").val(result[0].insuranceType.replaceAll(" ",""));
                    }
                    $("#ActualStartTime").attr('min',result[0].startTime.split("T")[0]);
                    $("#ActualEndTime").attr('max',result[0].endTime.split("T")[0]);
                    if(result[0].formStatus.replaceAll(" ","")=="審核通過"){
                        $("#Accept").prop("checked", true);
                        $('#RejectReasonDiv').hide();
                        $("#ActualStartTime").val(result[0].actualStartTime.split("T")[0]);
                        $("#ActualEndTime").val(result[0].actualEndTime.split("T")[0]);
                        if(result[0].laborRank!=null){
                            $("#LaborRank").val(result[0].laborRank);
                        }if(result[0].selfLabor!=null){
                            $("#SelfLabor").val(result[0].selfLabor);
                        }if(result[0].depLabor!=null){
                            $("#DepLabor").val(result[0].depLabor);
                        }if(result[0].laborFund!=null){
                            $("#LaborFund").val(result[0].laborFund);
                        }if(result[0].retireRank!=null){
                            $("#RetireRank").val(result[0].retireRank);
                        }
                        if(result[0].selfRetire!=null){
                            $("#SelfRetire").val(result[0].selfRetire);
                        }if(result[0].depRetire!=null){
                            $("#DepRetire").val(result[0].depRetire);
                        }
                    }else{
                        if(result[0].formStatus.replaceAll(" ","")=="審核中"){
                            $('#RejectReasonDiv').hide();
                            $('#ActualStartTimeDiv').hide();
                            $('#ActualEndTimeDiv').hide();
                            $('#ReceivePersonDiv').hide();
                        }if(result[0].formStatus.replaceAll(" ","")=="審核失敗"){
                            $("#Reject").prop("checked", true);
                            $('#ActualStartTimeDiv').hide();
                            $('#ActualEndTimeDiv').hide();
                            $("#RejectReason").val(result[0].rejectReason.replaceAll(" ",""));
                        }
                        $('#InsuranceTypeDiv').hide();
                        $("#LaborRankDiv").hide();
                        $("#SelfLaborDiv").hide();
                        $("#DepLaborDiv").hide();
                        $("#LaborFundDiv").hide();
                        $("#RetireRankDiv").hide();
                        $("#SelfRetireDiv").hide();
                        $("#DepRetireDiv").hide();
                    }
                    $("#SelfRetirePercent").val(result[0].selfRetirePercent);
                },
                error: function (error) {
                    console.log(error);
                }
            });
        });

        function insurancefee(){
            if($("#Accept").is(':checked')){
                var day = "null";
                var salary = 0;
                if($("#InsuranceType").val()!="月保" && $("#PartDay").val()!=""){
                    day = $("#PartDay").val();
                }
                var data = '{"Salary":'+ $("#Salary").val() +
                        ',"SelfRetirePercent":' + $("#SelfRetirePercent").val() +
                        ',"StartTime":"' + $("#ActualStartTime").val() +
                        '","EndTime":"' + $("#ActualEndTime").val() +
                        '","PartDay":"' + day +
                        '","Foreign":"' + $("#IsForeign").val() +
                        '","InsuranceType":"' + $("#InsuranceType").val() +'"}';
                console.log(data);
                $.ajax({
                    url:"/api/school/InsuranceFee",
                    type:"POST",
                    contentType: "application/json; charset=utf-8",
                    data: data,
                    success: function (result, status) {
                        console.log(result);
                        console.log(result[0].laborRank);
                        $("#LaborRank").val(result[0].laborRank);
                        $("#SelfLabor").val(result[0].selfLabor);
                        $("#DepLabor").val(result[0].depLabor);
                        $("#LaborFund").val(result[0].laborFund);
                        $("#RetireRank").val(result[0].retireRank);
                        $("#SelfRetire").val(result[0].selfRetire);
                        $("#DepRetire").val(result[0].depRetire);
                    },
                    error:function (error){
                        console.log(error);
                    }
                });
            }
        }
        
        $("#SalaryDiv").on('change',function(){
            if($( "#SalaryDiv option:selected" ).val()=="日薪"){
                $("#InsuranceType_Day").attr('disabled',false);
                $("#PartSalaryDiv").show();
                $("#PartSalaryDiv label").text("每日");
                $("#PartDayDiv").show();
                $("#PartDayDiv label").text("天數");
                count_salary();
            }if($( "#SalaryDiv option:selected" ).val()=="時薪"){
                $("#InsuranceType_Day").attr('disabled',false);
                $("#PartSalaryDiv").show();
                $("#PartSalaryDiv label").text("每小時");
                $("#PartDayDiv").show();
                $("#PartDayDiv label").text("天數");
                count_salary();
            }if($( "#SalaryDiv option:selected" ).val()=="月薪"){
                $("#InsuranceType_Day").attr('disabled','disabled');
                $("#PartSalary").val("");
                $("#PartSalaryDiv").hide();
                $("#PartDay").val("");
                $("#PartDayDiv").hide();
                $("#InsuranceType").val("月保");
                insurancefee();
            }
        })

        function count_salary(){
            if($("#PartSalary").val()!=""&&$("#PartDay").val()!=""){
                var num1 = $("#PartSalary").val();
                if($("#SalaryDiv option:selected").val() == "時薪"){
                    num1 = num1*8;
                }
                if($("#InsuranceType").val()=="日保"){
                    $("#Salary").val(num1*30);
                }else{
                    $("#Salary").val(num1*$("#PartDay").val());
                }
                insurancefee();
            }
        }
        $("#PartSalary").on('change', function () {
            count_salary();
        })

        $("#PartDay").on('change', function () {
            count_salary();
        })

        $("#FormStatusDiv").on('change',function(){
            if($( "#Accept").is(':checked')){
                $("#RejectReasonDiv").hide();
                $("#ActualStartTimeDiv").show();
                $("#ActualEndTimeDiv").show();
                if($("#ActualStartTime").val()==""){
                    $("#ActualStartTime").val($("#StartTime").val());
                }if($("#ActualEndTime").val()==""){
                    $("#ActualEndTime").val($("#EndTime").val());
                }
                $("#LaborRankDiv").show();
                $("#SelfLaborDiv").show();
                $("#DepLaborDiv").show();
                $("#LaborFundDiv").show();
                $("#RetireRankDiv").show();
                $("#SelfRetireDiv").show();
                $("#DepRetireDiv").show();
                $('#ReceivePersonDiv').show();
                $('#InsuranceTypeDiv').show();
                $('#InsuranceType').val("月保");
                if($("#LaborRank").val()==""||$("#SelfLabor").val()==""||$("#DepLabor").val()==""||$("#LaborFund").val()==""||$("#RetireRank").val()==""||$("#SelfRetire").val()==""||$("#DepRetire").val()==""){
                    var data = '{"Salary":'+ $("#Salary").val() +
                        ',"SelfRetirePercent":' + $("#SelfRetirePercent").val() +
                        ',"StartTime":"' + $("#ActualStartTime").val() +
                        '","EndTime":"' + $("#ActualEndTime").val() +
                        '","Foriegn":"' + $("#IsForeign").val() +
                        '","InsuranceType":"' + $("#InsuranceType").val() +'"}';
                    var temp = insurancefee(data);
                }
            }else{
                if($( "#Reject").is(':checked')){
                    $("#ActualStartTimeDiv").hide();
                    $("#ActualEndTimeDiv").hide();
                    $("#RejectReasonDiv").show();
                    $('#ReceivePersonDiv').show();
                }if($( "#Ing").is(':checked')){
                    $("#ActualStartTimeDiv").hide();
                    $("#ActualEndTimeDiv").hide();
                    $("#RejectReasonDiv").hide();
                    $('#ReceivePersonDiv').hide();
                }
                $("#LaborRankDiv").hide();
                $("#SelfLaborDiv").hide();
                $("#DepLaborDiv").hide();
                $("#LaborFundDiv").hide();
                $("#RetireRankDiv").hide();
                $("#SelfRetireDiv").hide();
                $("#DepRetireDiv").hide();
                $('#InsuranceTypeDiv').hide();
            }
        })

        $("#StartTime").on('change',function(){
            $("#ActualStartTime").attr('min',$("#StartTime").val());
        })

        $("#EndTime").on('change',function(){
            $("#ActualEndTime").attr('max',$("#EndTime").val());
        })

        $("#ActualStartTime").on('change',function(){
            if($("#SalaryDiv option:selected").val() == "月薪"){
                insurancefee();
            }else{
                count_salary();
            }
            $("#ActualEndTime").attr('min',$("#ActualStartTime").val());
        })

        $("#ActualEndTime").on('change',function(){
            if($("#SalaryDiv option:selected").val() == "月薪"){
                insurancefee();
            }else{
                count_salary();
            }
        })

        $("#InsuranceType").on('change',function(){
            if($("#SalaryDiv option:selected").val() == "月薪"){
                insurancefee();
            }else{
                count_salary();
            }
        })

        $("#SelfRetirePercent").on('change',function(){
            if($("#SalaryDiv option:selected").val() == "月薪"){
                insurancefee();
            }else{
                count_salary();
            }
        })

        $("#Salary").on('change',function(){
            if($("#SalaryDiv option:selected").val() == "月薪"){
                insurancefee();
            }else{
                count_salary();
            }
        })

        $("#IsForeign").on('change',function(){
            if($("#SalaryDiv option:selected").val() == "月薪"){
                insurancefee();
            }else{
                count_salary();
            }
        })
        $("#StudentID").on('change', function (){
            var data = '{"Student_ID": "'+ this.value + '"}';
            var temp = StudentInfo(data);
        })

        function getFormData($form){
            var unindexed_array = $form.serializeArray();
            var indexed_array = {};
            $.map(unindexed_array, function(n, i){
                indexed_array[n['name']] = n['value'];
            });
            return indexed_array;
        }

        $("#updatelabform").on('submit',function (e) {
            e.preventDefault();
            if($( "#Accept").is(':checked')){
                $("#RejectReason").val("");
            }else{
                $("#LaborRank").val("");
                $("#SelfLabor").val("");
                $("#DepLabor").val("");
                $("#LaborFund").val("");
                $("#RetireRank").val("");
                $("#SelfRetire").val("");
                $("#DepRetire").val("");
                $('#InsuranceType').val("");
                $("#ActualStartTime").val("");
                $("#ActualEndTime").val("");
                if($( "#Ing").is(':checked')){
                    $('#ReceivePerson').val(null);
                    $("#RejectReason").val(null);
                }
            }
            var $form = $("#updatelabform");
            var data = getFormData($form);
            //console.log(JSON.stringify(data));
            $("#targetDiv").empty();
            $.ajax({
                url: "/api/school/manage",
                type: "PUT",
                contentType: "application/json; charset=utf-8",
                data: JSON.stringify(data),
                success: function (result, status) {
                    console.log(result);
                    $("#targetDiv").append('<div>申請項目:' + result.applyItem + '</div>');
                    $("#targetDiv").append('<div>被保險人學號:' + result.studentID + '</div>');
                    $("#targetDiv").append('<div>被保險人姓名:' + result.hiredName + '</div>');
                    $("#targetDiv").append('<div>被保險人身分證字號:' + result.id + '</div>');
                    $("#targetDiv").append('<div>被保險人學校/系所:' + result.school + '</div>');
                    $("#targetDiv").append('<div>被保險人出生日期:' + result.birthday.split("T")[0] + '</div>');
                    $("#targetDiv").append('<div>被保險人手機:' + result.phone + '</div>');
                    $("#targetDiv").append('<div>被保險人E-mail:' + result.email + '</div>');
                    $("#targetDiv").append('<div>被保險人國籍:' + result.isForeign + '</div>');
                    $("#targetDiv").append('<div>被保險人身心障礙等級:' + result.disability + '</div>');
                    $("#targetDiv").append('<div>被保險人工作類別:' + result.workType + '</div>');
                    $("#targetDiv").append('<div>用人單位:' + result.hiredDep + '</div>');
                    $("#targetDiv").append('<div>僱主:' + result.boss + '</div>');
                    $("#targetDiv").append('<div>計畫編號:' + result.bugeno + '</div>');
                    $("#targetDiv").append('<div>起始/退保時間:' + result.startTime.split("T")[0] + '</div>');
                    $("#targetDiv").append('<div>結束時間:' + result.endTime.split("T")[0] + '</div>');
                    $("#targetDiv").append('<div>薪資類別:' + result.class + '</div>');
                    if(result.class=="日薪"){
                        $("#targetDiv").append('<div>每日:' + result.partSalary + '元</div>');
                    }if(result.class=="時薪"){
                        $("#targetDiv").append('<div>每小時:' + result.partSalary + '元</div>');
                    }
                    $("#targetDiv").append('<div>薪水:' + result.salary + '</div>');
                    $("#targetDiv").append('<div>自提勞工退休金:' + result.selfRetirePercent + '%</div>');
                    //labInsuranceFee
                    if(result.insuranceType!=null){
                        $("#targetDiv").append('<div id=InsuranceType>投保類型:' + result.insuranceType + '</div>');
                    }
                    if(result.receiveTime!=null){
                        $("#targetDiv").append('<div>收件時間:' + result.receiveTime.split("T")[0] + '</div>');
                    }if(result.formStatus.replaceAll(" ","")!="審核中"&&result.receivePerson!=null){
                        $("#targetDiv").append('<div>收件人:' + result.receivePerson + '</div>');
                    }
                    $("#targetDiv").append('<div>審核狀態:' + result.formStatus + '</div>');
                    if(result.actualStartTime!=null){
                        $("#targetDiv").append('<div>實際加保日期:' + result.actualStartTime.split("T")[0] + '</div>');
                    }if(result.rejectReason!=null){
                        $("#targetDiv").append('<div>審核失敗原因:' + result.rejectReason + '</div>');
                    }if(result.laborRank!=null){
                        $("#targetDiv").append('<div>勞保級距:' + result.laborRank + '</div>');
                    }if(result.selfLabor!=null){
                        $("#targetDiv").append('<div>勞保自提:' + result.selfLabor + '</div>');
                    }if(result.depLabor!=null){
                        $("#targetDiv").append('<div>勞保公提:' + result.depLabor + '</div>');
                    }if(result.laborFund!=null){
                        $("#targetDiv").append('<div>勞保工資墊償金:' + result.laborFund + '</div>');
                    }if(result.retireRank!=null){
                        $("#targetDiv").append('<div>勞退級距:' + result.retireRank + '</div>');
                    }if(result.selfRetirePercent!=null){
                        $("#targetDiv").append('<div>自提勞工退休金:' + result.selfRetirePercent + '%</div>');
                    }if(result.selfRetire!=null){
                        $("#targetDiv").append('<div>勞退自提:' + result.selfRetire + '</div>');
                    }if(result.depRetire!=null){
                        $("#targetDiv").append('<div>勞退公提:' + result.depRetire + '</div>');
                    }
                },
                error: function (error) {
                    console.log(error);
                    $("small").empty();
                    if(error.responseJSON.errors.StudentID!=null){
                        $("#StudentIDSmall").append(error.responseJSON.errors.StudentID);
                    }if(error.responseJSON.errors.HiredName!=null){
                        $("#HiredNameSmall").append(error.responseJSON.errors.HiredName);
                    }if(error.responseJSON.errors.ID!=null){
                        $("#IDSmall").append(error.responseJSON.errors.ID);
                    }if(error.responseJSON.errors.HiredDep!=null){
                        $("#HiredDepSmall").append(error.responseJSON.errors.HiredDep);
                    }if(error.responseJSON.errors.Birthday!=null){
                        $("#BirthdaySmall").append(error.responseJSON.errors.Birthday);
                    }if(error.responseJSON.errors.Phone!=null){
                        $("#PhoneSmall").append(error.responseJSON.errors.Phone);
                    }if(error.responseJSON.errors.Email!=null){
                        $("#EmailSmall").append(error.responseJSON.errors.Email);
                    }if(error.responseJSON.errors.School!=null){
                        $("#SchoolSmall").append(error.responseJSON.errors.School);
                    }if(error.responseJSON.errors.Salary!=null){
                        $("#SalarySmall").append(error.responseJSON.errors.Salary);
                    }if(error.responseJSON.errors.Boss!=null){
                        $("#BossSmall").append(error.responseJSON.errors.Boss);
                    }if(error.responseJSON.errors.ProjectID!=null){
                        $("#ProjectIDSmall").append(error.responseJSON.errors.ProjectID);
                    }if(error.responseJSON.errors.StartTime!=null){
                        $("#StartTimeSmall").append(error.responseJSON.errors.StartTime);
                    }if(error.responseJSON.errors.EndTime!=null){
                        $("#EndTimeSmall").append(error.responseJSON.errors.EndTime);
                    }if(error.responseJSON.errors.PartSalary!=null){
                        $("#PartSalarySmall").append(error.responseJSON.errors.PartSalary);
                    }if(error.responseJSON.errors.ActualStartTime!=null){
                        $("#ActualStartTimeSmall").append(error.responseJSON.errors.ActualStartTime);
                    }if(error.responseJSON.errors.RejectReason!=null){
                        $("#RejectReasonSmall").append(error.responseJSON.errors.RejectReason);
                    }if(error.responseJSON.errors.ReceivePerson!=null){
                        $("#ReceivePersonSmall").append(error.responseJSON.errors.ReceivePerson);
                    }
                }
            });
        });
    </script>
}